# 🚀 Fly.io 배포하기 (초간단 가이드)

## ⚡ 5분 안에 배포 완료!

### 방법 1: 자동 스크립트 (가장 쉬움) ✨

#### Windows:

```cmd
cd backend_ai
deploy.bat
```

#### Mac/Linux:

```bash
cd backend_ai
chmod +x deploy.sh
./deploy.sh
```

**끝!** 스크립트가 자동으로:

1. ✅ Fly CLI 확인
2. ✅ 로그인 확인
3. ✅ 환경변수 설정 (선택)
4. ✅ 빌드 & 배포
5. ✅ 상태 확인

---

### 방법 2: 수동 배포 (직접 제어)

#### 1단계: 환경변수 설정 (1분)

```bash
cd backend_ai

# 자동으로 .env에서 가져오기 (추천!)
fly secrets import < .env

# 또는 수동으로 하나씩
fly secrets set OPENAI_API_KEY="sk-proj-..."
fly secrets set UPSTASH_REDIS_REST_URL="https://flying-bluejay-43275.upstash.io"
fly secrets set UPSTASH_REDIS_REST_TOKEN="AakLAA..."
```

#### 2단계: 배포 (3-5분)

```bash
fly deploy
```

**완료!** ✅

---

## 📊 배포 확인 (30초)

### 1. 헬스 체크

```bash
curl https://backend-ai.fly.dev/health
```

✅ 응답: `{"status":"healthy"}`

### 2. Redis 연결 확인

```bash
curl https://backend-ai.fly.dev/health/full -H "Authorization: Bearer 0a0bd7ccf9e607a4aafb7f5b03b7e0e8bf18ec0c3949b2ee8522b8a5d9d07e69"
```

✅ `"cache_enabled": true` 확인

### 3. 기능 확인

```bash
curl https://backend-ai.fly.dev/capabilities -H "Authorization: Bearer 0a0bd7ccf9e607a4aafb7f5b03b7e0e8bf18ec0c3949b2ee8522b8a5d9d07e69"
```

✅ `"enabled": 16` 확인

---

## 🔗 프론트엔드 연결

프로젝트 루트의 `.env.local` 파일 수정:

```bash
AI_BACKEND_URL="https://backend-ai.fly.dev"
BACKEND_AI_URL="https://backend-ai.fly.dev"
NEXT_PUBLIC_AI_BACKEND="https://backend-ai.fly.dev"
```

---

## 🔍 문제 발생 시

### 로그 확인

```bash
fly logs -f
```

### 앱 재시작

```bash
fly apps restart backend-ai
```

### 환경변수 확인

```bash
fly secrets list
```

---

## 📝 자주 사용하는 명령어

```bash
# 배포
fly deploy

# 로그 보기
fly logs -f

# 상태 확인
fly status

# 환경변수 보기
fly secrets list

# 앱 재시작
fly apps restart backend-ai
```

---

## 🎯 완료 체크리스트

배포 후 확인:

- [ ] `fly status` - ✅ 앱 실행 중
- [ ] `curl https://backend-ai.fly.dev/health` - ✅ healthy
- [ ] Redis 연결 확인 - ✅ cache_enabled: true
- [ ] 16/16 기능 확인 - ✅ enabled: 16
- [ ] 프론트엔드 `.env.local` 업데이트 - ✅
- [ ] 프론트엔드 테스트 - ✅

---

## 🎉 배포 완료!

**백엔드 URL**: https://backend-ai.fly.dev

**프론트엔드에서 사용**:

- API 호출: `https://backend-ai.fly.dev/calc_saju`
- 헬스 체크: `https://backend-ai.fly.dev/health`
- 기능 확인: `https://backend-ai.fly.dev/capabilities`

**모니터링**:

- 대시보드: https://fly.io/dashboard
- 로그: `fly logs -f`
- 성능: `curl https://backend-ai.fly.dev/api/analytics/performance`

---

## 🚀 이제 프론트엔드도 배포하세요!

```bash
cd .. # 프로젝트 루트로
vercel --prod
```

**모든 준비 완료!** 🎊

---

## 💡 팁

1. **빠른 재배포**: 코드 수정 후 `fly deploy` 만 실행
2. **환경변수 변경**: `fly secrets set KEY=VALUE` 후 자동 재시작
3. **롤백**: 문제 발생 시 `fly releases rollback`
4. **스케일업**: 트래픽 증가 시 `fly scale vm shared-cpu-4x`

---

**문제 있으면 `FLY_DEPLOY.md` 상세 가이드 참고!** 📖
