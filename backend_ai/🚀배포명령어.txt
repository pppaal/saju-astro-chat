# 🚀 Fly.io 배포 - 복사해서 붙여넣기만 하세요!

## ===============================================
## 1단계: 환경변수 설정 (한 번만 실행)
## ===============================================

cd backend_ai

# 모든 환경변수 한 번에 설정 (가장 쉬운 방법!)
fly secrets import < .env

# 완료! 이제 2단계로 →


## ===============================================
## 2단계: 배포 실행 (3-5분 소요)
## ===============================================

fly deploy

# 완료! 이제 3단계로 →


## ===============================================
## 3단계: 배포 확인 (30초)
## ===============================================

# 상태 확인
fly status

# 로그 확인 (Redis 연결 확인!)
fly logs

# 헬스 체크
curl https://backend-ai.fly.dev/health

# Redis 연결 확인 (중요!)
curl https://backend-ai.fly.dev/health/full -H "Authorization: Bearer 0a0bd7ccf9e607a4aafb7f5b03b7e0e8bf18ec0c3949b2ee8522b8a5d9d07e69"

# 기능 확인 (16/16 확인!)
curl https://backend-ai.fly.dev/capabilities -H "Authorization: Bearer 0a0bd7ccf9e607a4aafb7f5b03b7e0e8bf18ec0c3949b2ee8522b8a5d9d07e69"


## ===============================================
## 4단계: 프론트엔드 연결
## ===============================================

# 프로젝트 루트의 .env.local 파일에 추가:
AI_BACKEND_URL=https://backend-ai.fly.dev
BACKEND_AI_URL=https://backend-ai.fly.dev
NEXT_PUBLIC_AI_BACKEND=https://backend-ai.fly.dev


## ===============================================
## 🎉 완료!
## ===============================================

백엔드 URL: https://backend-ai.fly.dev

다음 단계:
1. 프론트엔드 .env.local 업데이트 (위 참고)
2. 프론트엔드 배포: vercel --prod
3. 테스트!


## ===============================================
## 📝 자주 사용하는 명령어
## ===============================================

# 로그 실시간 보기
fly logs -f

# 앱 재시작
fly apps restart backend-ai

# 상태 확인
fly status

# 환경변수 목록
fly secrets list

# 대시보드 열기
fly dashboard


## ===============================================
## 🔧 문제 해결
## ===============================================

# 환경변수 다시 설정
fly secrets set OPENAI_API_KEY="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"
fly secrets set TOGETHER_API_KEY="tgp_v1_afRBimIy_litRtsz-xPkSOoR2tvnobJx5iKbki9wZQ4"
fly secrets set ADMIN_API_TOKEN="0a0bd7ccf9e607a4aafb7f5b03b7e0e8bf18ec0c3949b2ee8522b8a5d9d07e69"
fly secrets set UPSTASH_REDIS_REST_URL="https://flying-bluejay-43275.upstash.io"
fly secrets set UPSTASH_REDIS_REST_TOKEN="AakLAAIncDIwMzdiZTlmMTRhZjY0MTRiODUyYTRiYTVkM2YxZDg5N3AyNDMyNzU"
fly secrets set WARMUP_ON_START="1"
fly secrets set WARMUP_OPTIMIZED="1"
fly secrets set FLASK_ENV="production"

# 재배포
fly deploy

# 롤백 (문제 발생 시)
fly releases
fly releases rollback <version>


## ===============================================
## ⚡ 초간단 버전 (3단계만!)
## ===============================================

# 1. 환경변수 설정
cd backend_ai
fly secrets import < .env

# 2. 배포
fly deploy

# 3. 확인
curl https://backend-ai.fly.dev/health

# 끝! 🎉
