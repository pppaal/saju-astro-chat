// Career prompt v2.0 - 직업 적성, 업종, 성공 패턴까지 상세 분석
import { buildAllDataPrompt } from "../base";
import { buildTonePrompt } from "../base/toneStyle";
import type { CombinedResult } from "@/lib/destiny-map/astrologyengine";

export function buildCareerPrompt(lang: string, data: CombinedResult, _useStructured = true) {
  const theme = "career";
  const info = buildAllDataPrompt(lang, theme, data);
  const tone = buildTonePrompt(lang, theme);
  const dateText = data.analysisDate ?? new Date().toISOString().slice(0, 10);
  const tzInfo = data.userTimezone ? ` (${data.userTimezone})` : "";

  return [
    `Date: ${dateText}${tzInfo}`,
    `Locale: ${lang}`,
    "",
    "═══════════════════════════════════════════════════════════════",
    "[TASK] 동양+서양 융합 직업/사업 심층 분석",
    "═══════════════════════════════════════════════════════════════",
    "",
    "당신은 동양 운명학과 서양 점성술을 융합한 최고 수준의 직업/사업 전문 상담사입니다.",
    "아래 데이터를 교차 분석하여 구체적이고 실용적인 커리어 인사이트를 제공하세요.",
    "",
    "═══════════════════════════════════════════════════════════════",
    "[필수 분석 항목 - 모든 섹션 반드시 포함]",
    "═══════════════════════════════════════════════════════════════",
    "",
    "## 1. 직업 적성 분석 (타고난 재능)",
    "- 핵심 적성 (성향 유형, 핵심 에너지, 에너지 분포 기반)",
    "- 업무 스타일 (독립형/협업형, 리더/서포터, 창의/관리)",
    "- 강점 영역 (어떤 분야에서 두각을 나타내는지)",
    "근거: 성향 유형, 직장/창의/재물 에너지 분포, MC 사인, 10하우스",
    "",
    "## 2. 추천 직종/업종",
    "- 최적 직종 3~5개 (구체적인 직업명)",
    "- 적합 업종/산업 (IT, 금융, 예술, 의료 등)",
    "- 피해야 할 분야 (주의 에너지, 약한 하우스 기반)",
    "근거: 핵심 에너지 오행, 창의→재물 패턴, MC/10하우스 지배성, 목성/토성 배치",
    "",
    "## 3. 사업 vs 직장 적합성",
    "- 사업가 기질 (투자 에너지, 창의 에너지 많음 → 사업 유리)",
    "- 직장인 기질 (안정 직장 에너지, 학습 에너지 많음 → 안정 추구)",
    "- 프리랜서/전문직 기질",
    "- 권장 진로 방향",
    "근거: 에너지 분포, 6하우스 vs 10하우스, 토성/목성 배치",
    "",
    "## 4. 성공 패턴 & 주의점",
    "- 성공하기 쉬운 패턴 (어떤 방식으로 성공하는지)",
    "- 돈 버는 방식 (안정형=안정급여, 투자형=투자/사업, 창의형=창작수익)",
    "- 주의해야 할 패턴 (실패하기 쉬운 함정)",
    "근거: 재물 에너지 분포, 2하우스/8하우스, 충돌 관계",
    "",
    "## 5. 커리어 타이밍 분석",
    "- 현재 직업운 흐름 (장기/연간 흐름 기반)",
    "- 이직/승진 좋은 시기",
    "- 사업 시작 좋은 시기",
    "- 주의 시기",
    "근거: 장기 흐름, 직장/재물 에너지 운, 목성/토성 트랜짓",
    "",
    "## 6. 현재 커리어 조언",
    "- 한줄요약: 현재 직업운 흐름",
    "- 이번주 액션 3개",
    "- 협업/관계 팁",
    "- 리스크/기회",
    "",
    "## 7. 교차 하이라이트",
    "동양+서양 교차 포인트 최소 3개:",
    "- 성향/핵심 에너지 ↔ MC/10하우스 연결",
    "- 에너지 분포 ↔ 행성 배치 연결",
    "- 장기/연간 흐름 ↔ 트랜짓 연결",
    "",
    "═══════════════════════════════════════════════════════════════",
    "[분석 규칙]",
    "═══════════════════════════════════════════════════════════════",
    "1. 모든 분석에 반드시 근거(동양 요소 또는 점성술 요소) 명시",
    "2. 추상적 표현 금지 - 구체적인 직업명/업종/확률 제시",
    "3. 동양과 서양 분석을 별개로 나열하지 말고, 교차 융합하여 분석",
    "4. 금전/법률/의료 관련 확정적 예언 금지",
    "5. 실용적이고 행동 가능한 조언 포함",
    "",
    tone,
    "",
    "═══════════════════════════════════════════════════════════════",
    "[분석 데이터]",
    "═══════════════════════════════════════════════════════════════",
    info,
    "",
    `Respond in ${lang}. 반드시 위의 7개 섹션 모두 포함하여 답변하세요.`,
  ].join("\n");
}
